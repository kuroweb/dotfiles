---
description: 要件を再確認し、既存コードを体系的に調査し、原因分析・改善案・実装方針を含む詳細レポートを作成します。コードに触れる前に調査計画をユーザーに提示します。
---

# 調査コマンド

このコマンドは**code-investigator**エージェントを呼び出し、既存コードを体系的に調査して詳細なレポートを作成します。

## このコマンドの機能

1. **調査依頼の分析** - 何を調査する必要があるか明確化
2. **調査計画の策定** - 調査範囲とステップを提示
3. **体系的な調査** - Grep、Glob、SemanticSearchを活用
4. **構造化レポート** - データで裏付けられた対応方針を報告

## 使用するタイミング

`/investigate`を使用する場合:

- バグの原因を特定したいとき
- 既存機能の仕様を理解したいとき
- パフォーマンス問題を分析したいとき
- リファクタリング前の影響調査をするとき
- データ整合性を確認したいとき
- デッドコードを特定したいとき

## 動作の仕組み

code-investigatorエージェントは以下を行います:

1. **調査依頼を分析**し、調査対象・目的・範囲を明確化
2. **調査計画を提示**し、確認を待つ
3. **コードベースを探索**し、関連情報を収集
4. **データを分析**し、パターンや問題を特定
5. **レポートを作成**し、👉で具体的な対応方針を明示

## 使用例

```
ユーザー: /investigate 旧カートAPIのテーブル参照を調査して新方式への移行方針を決めたい

エージェント (code-investigator):
# 調査計画: 旧カートAPIのテーブル移行

## 調査目的
- 旧カートAPI（`/api/cart/add`）が参照するテーブルを特定
- 新方式テーブルへの移行方針を策定

## 調査範囲
- 旧カートAPIのコントローラー・サービス層
- 関連テーブルのアクセス状況（BigQuery）
- 過去の議論（Slack、チケット）

## 調査ステップ
1. APIエンドポイントのコード特定（Grep）
2. 関連テーブルへのクエリ箇所を特定（Grep）
3. アクセスログ分析（BigQuery）
4. 過去の議論を追跡

**確認を待っています**: この調査計画で進めますか？（はい/いいえ/修正）
```

## 重要な注意事項

**推奨される使い方:**

- 調査依頼は具体的に（例: 「決済金額が0.01円ずれる問題」）
- 調査範囲を明確に（例: 「payment_service.rbの手数料計算部分」）
- 期待する成果物を指定（例: 「原因特定のみ」「修正案まで」「実装計画まで」）

変更が必要な場合は、以下のように返答してください:

- 「修正: [変更内容]」
- 「範囲を広げて: [追加調査対象]」
- 「この部分だけ先に: [優先調査項目]」

## 他のコマンドとの統合

調査完了後:

- `/plan` - 調査結果を基に実装計画を作成
- `/tdd` - テスト駆動で修正を実装
- `/code-review` - 修正案のセキュリティレビュー

## 関連ファイル

- エージェント: `.cursor/agents/code-investigator.md`
- スキル: `.cursor/skills/investigation-report/`
